/*!
   angular-block-ui v0.2.0
   (c) 2015 (null) McNull https://github.com/McNull/angular-block-ui
   License: MIT
*/
!function(t){function e(e){try{t.module(e)}catch(o){return!1}return!0}function o(t,o,n){function i(){t.$on("$locationChangeStart",function(t){o.$_blockLocationChange&&o.state().blockCount>0&&t.preventDefault()}),t.$on("$locationChangeSuccess",function(){o.$_blockLocationChange=n.blockBrowserNavigation})}if(n.blockBrowserNavigation)if(e("ngRoute"))var r=t.$on("$viewContentLoaded",function(){r(),i()});else i()}var n=t.module("blockUI",[]);n.config(["$provide","$httpProvider",function(t,e){t.decorator("$exceptionHandler",["$delegate","$injector",function(t,e){var o,n;return function(i,r){if(n=n||e.get("blockUIConfig"),n.resetOnException)try{o=o||e.get("blockUI"),o.instances.reset()}catch(c){console.log("$exceptionHandler",i)}t(i,r)}}]),e.interceptors.push("blockUIHttpInterceptor")}]),n.run(["$document","blockUIConfig","$templateCache",function(t,e,o){e.autoInjectBodyBlock&&t.find("body").attr("block-ui","main"),e.template&&(e.templateUrl="$$block-ui-template$$",o.put(e.templateUrl,e.template))}]),n.config(["$provide",function(t){t.decorator("$location",i)}]);var i=["$delegate","blockUI","blockUIConfig",function(e,o,n){function i(t){var n=e[t];e[t]=function(){var t=n.apply(e,arguments);return t===e&&(o.$_blockLocationChange=!1),t}}if(n.blockBrowserNavigation){o.$_blockLocationChange=!0;var r=["url","path","search","hash","state"];t.forEach(r,i)}return e}];n.directive("blockUiContainer",["blockUIConfig","blockUiContainerLinkFn",function(t,e){return{scope:!0,restrict:"A",templateUrl:t.templateUrl,compile:function(){return e}}}]).factory("blockUiContainerLinkFn",["blockUI","blockUIUtils",function(){return function(t,e){var o=e.inheritedData("block-ui");if(!o)throw new Error("No parent block-ui service instance located.");t.state=o.state(),t.$_stop=function(){"use strict";o.stop()}}}]),n.directive("blockUi",["blockUiCompileFn",function(t){return{scope:!0,restrict:"A",compile:t}}]).factory("blockUiCompileFn",["blockUiPreLinkFn",function(t){return function(e){return e.append('<div block-ui-container class="block-ui-container"></div>'),{pre:t}}}]).factory("blockUiPreLinkFn",["blockUI","blockUIUtils","blockUIConfig",function(t,e,n){return function(i,r,c){r.hasClass("block-ui")||r.addClass(n.cssClass),c.$observe("blockUiMessageClass",function(t){i.$_blockUiMessageClass=t});var a=c.blockUi||"_"+i.$id,s=t.instances.get(a);if("main"===a)o(i,s,n);else{var l=r.inheritedData("block-ui");l&&(s._parent=l)}i.$on("$destroy",function(){s.release()}),s.addRef(),i.$_blockUiState=s.state(),i.$watch("$_blockUiState.blocking",function(t){r.attr("aria-busy",!!t),r.toggleClass("block-ui-visible",!!t)}),i.$watch("$_blockUiState.blockCount > 0",function(t){r.toggleClass("block-ui-active",!!t)});var u=c.blockUiPattern;if(u){var f=e.buildRegExp(u);s.pattern(f)}r.data("block-ui",s)}}]),n.constant("blockUIConfig",{templateUrl:"angular-block-ui/angular-block-ui.ng.html",delay:250,wait:1e3,message:"Loading ...",options:{status:"isLoading",statusMessageShowWait:1e3},autoBlock:!0,resetOnException:!0,requestFilter:t.noop,autoInjectBodyBlock:!0,cssClass:"block-ui block-ui-anim-fade",blockBrowserNavigation:!1}),n.factory("blockUIHttpInterceptor",["$q","$injector","blockUIConfig","$templateCache",function(t,e,o,n){function i(){a=a||e.get("blockUI")}function r(t){o.autoBlock&&t&&!t.$_noBlock&&t.$_blocks&&(i(),t.$_blocks.stop())}function c(e){try{r(e.config)}catch(o){console.log("httpRequestError",o)}return t.reject(e)}var a;return{request:function(t){if(o.autoBlock&&("GET"!=t.method||!n.get(t.url))){var e=o.requestFilter(t);e===!1?t.$_noBlock=!0:(i(),t.$_blocks=a.instances.locate(t),t.$_blocks.start(e))}return t},requestError:c,response:function(t){return t&&r(t.config),t},responseError:c}}]),n.factory("blockUI",["blockUIConfig","$timeout","blockUIUtils","$document",function(e,o,n,i){function r(r){var a,l=this,u={id:r,blockCount:0,message:e.message,options:e.options,blocking:!1,_startTimestamp:0},f=[];this._id=r,this._refs=0,l._waitforDismissTimer=null,this.start=function(r){r=u.blockCount>0?r||u.message||e.message:r||e.message,u.message=r,u.options=t.copy(e.options),u.blockCount++;var c=t.element(i[0].activeElement);c.length&&n.isElementInBlockScope(c,l)&&(l._restoreFocus=c[0],o(function(){l._restoreFocus&&l._restoreFocus.blur()})),a||(a=o(function(){a=null,u.blocking=!0,u._startTimestamp=new Date},e.delay))},this._cancelStartTimeout=function(){a&&(o.cancel(a),a=null)},this.stop=function(n,i){i=i||{},t.extend(u.options,i);var r=new Date,c=u._startTimestamp.getTime()-r.getTime()-e.wait;c=c>0?c:0,t.isDefined(n)&&(u.message=n,c+=u.options.statusMessageShowWait),this._waitforDismissTimer=o(function(){"use strict";u.blockCount=Math.max(0,--u.blockCount),0===u.blockCount&&(o.cancel(l._waitforDismissTimer),l.reset(!0))},c)},this.isBlocking=function(){return u.blocking},this.message=function(e,o){o=o||{},t.extend(u.options,o),u.message=e},this.option=function(t){"use strict";u.options=t},this.pattern=function(t){return void 0!==t&&(l._pattern=t),l._pattern},this.reset=function(e){l._cancelStartTimeout(),u.blockCount=0,u.blocking=!1,!l._restoreFocus||i[0].activeElement&&i[0].activeElement!==c[0]||(l._restoreFocus.focus(),l._restoreFocus=null);try{e&&t.forEach(f,function(t){t()})}finally{f.length=0}},this.done=function(t){f.push(t)},this.state=function(){return u},this.addRef=function(){l._refs+=1},this.release=function(){--l._refs<=0&&s.instances._destroy(l)}}var c=i.find("body"),a=[];a.get=function(t){if(!isNaN(t))throw new Error("BlockUI id cannot be a number");var e=a[t];return e||(e=a[t]=new r(t),a.push(e)),e},a._destroy=function(e){if(t.isString(e)&&(e=a[e]),e){e.reset();var o=n.indexOf(a,e);a.splice(o,1),delete a[e.state().id]}},a.locate=function(t){var e=[];n.forEachFnHook(e,"start"),n.forEachFnHook(e,"stop");for(var o=a.length;o--;){var i=a[o],r=i._pattern;r&&r.test(t.url)&&e.push(i)}return 0===e.length&&e.push(s),e},n.forEachFnHook(a,"reset");var s=a.get("main");return s.addRef(),s.instances=a,s}]),n.factory("blockUIUtils",function(){var e=t.element,o={buildRegExp:function(t){var e,o=t.match(/^\/(.*)\/([gim]*)$/);if(!o)throw Error("Incorrect regular expression format: "+t);return e=new RegExp(o[1],o[2])},forEachFn:function(t,e,o){for(var n=t.length;n--;){var i=t[n];i[e].apply(i,o)}},forEachFnHook:function(t,e){t[e]=function(){o.forEachFn(this,e,arguments)}},isElementInBlockScope:function(t,e){for(var o=t.inheritedData("block-ui");o;){if(o===e)return!0;o=o._parent}return!1},findElement:function(t,n,i){var r=null;if(n(t))r=t;else{var c;c=i?t.parent():t.children();for(var a=c.length;!r&&a--;)r=o.findElement(e(c[a]),n,i)}return r},indexOf:function(t,e,o){for(var n=o||0,i=t.length;i>n;n++)if(t[n]===e)return n;return-1}};return o}),t.module("blockUI").run(["$templateCache",function(t){t.put("angular-block-ui/angular-block-ui.ng.html",'<div class="block-ui-overlay"></div><div class="block-ui-message-container" aria-live="assertive" aria-atomic="true"><div class="block-ui-message" ng-class="$_blockUiMessageClass">{{ state.message }}</div></div>')}])}(angular);
//# sourceMappingURL=angular-block-ui.min.js.map